apiVersion: apps/v1  # Versão da API do Kubernetes
kind: Deployment     # Tipo: Gerenciador de Pods
metadata:
  name: backend-deployment  # Nome único do Deployment
  namespace: k8slab        # Namespace onde será criado
  labels:
    app: backend           # Label para organização
spec:
  replicas: 2              # ← QUANTOS PODS CRIAR (sempre 2 rodando)
  selector:                # ← COMO ENCONTRAR OS PODS
    matchLabels:
      app: backend         # Procura Pods com label "app: backend"
  template:                # ← DEFINIÇÃO DO POD (planta do apartamento)
    metadata:
      labels:
        app: backend       # ← LABEL QUE CADA POD TERÁ
    spec:                  # ← ESPECIFICAÇÃO DO POD
      containers:          # ← CONTAINERS DENTRO DO POD
      - name: backend      # Nome do container
        image: k8slab-backend:latest  # Imagem Docker
        ports:
        - containerPort: 8080        # Porta que o container expõe
        env:                         # Variáveis de ambiente
        - name: SPRING_PROFILES_ACTIVE
          value: "kubernetes"        # Profile específico para K8s
        resources:                   # ← LIMITES DE RECURSOS
          requests:                  # Mínimo garantido
            memory: "256Mi"          # 256MB RAM mínimo
            cpu: "250m"              # 0.25 CPU mínimo
          limits:                    # Máximo permitido
            memory: "512Mi"          # 512MB RAM máximo
            cpu: "500m"              # 0.5 CPU máximo
        livenessProbe:             # ← VERIFICA SE ESTÁ VIVO
          httpGet:
            path: /api/ola           # Endpoint para testar
            port: 8080
          initialDelaySeconds: 30    # Espera 30s antes de testar
          periodSeconds: 10          # Testa a cada 10s
        readinessProbe:            # ← VERIFICA SE ESTÁ PRONTO
          httpGet:
            path: /api/ola           # Endpoint para testar
            port: 8080
          initialDelaySeconds: 5     # Espera 5s antes de testar
          periodSeconds: 5           # Testa a cada 5s
---
# Função: Gerencia quantos Pods do backend queremos rodando
# Analogia: "Síndico" que garante sempre 2 apartamentos (Pods) funcionando
# Benefícios: Auto-scaling, self-healing, rolling updates